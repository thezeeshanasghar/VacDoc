(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{id4T:function(l,n,t){"use strict";t.r(n);var e=t("8Y7J"),i=t("mrSG"),a=t("UXh4"),o=t("AytR"),s=t("Do2H"),r=t("lJxs"),u=t("JIr8"),c=t("IheW");let d=(()=>{class l extends s.a{constructor(l){super(l),this.http=l,this.API_ALERT=""+o.a.BASE_URL,this.API_DOCTOR=o.a.BASE_URL+"doctor"}getBirthdayAlert(l,n){return this.http.get(`${this.API_ALERT}birthday/${n}?inputDate=${l}`,this.httpOptions).pipe(Object(r.a)(this.extractData),Object(u.a)(this.handleError))}sendEmailToAll(l){return this.http.get(`${this.API_ALERT}Birthday/birthdaymail/bulk/${l}`,this.httpOptions).pipe(Object(r.a)(this.extractData),Object(u.a)(this.handleError))}sendBirthdayMails(l){return this.http.get(`${this.API_ALERT}Birthday/birthdaymail/${l}`,this.httpOptions).pipe(Object(r.a)(this.extractData),Object(u.a)(this.handleError))}loadDoctorDetails(l){return this.http.get(`${this.API_DOCTOR}/${l}`,this.httpOptions).pipe(Object(r.a)(this.extractData),Object(u.a)(this.handleError))}}return l.ngInjectableDef=e.Rb({factory:function(){return new l(e.Sb(c.c))},token:l,providedIn:"root"}),l})();var b=t("Tw+x");class h{constructor(l,n,t,e,i,a){this.loadingController=l,this.birthdayService=n,this.toastService=t,this.storage=e,this.platform=i,this.downloader=a,this.selectedDate=(new Date).toISOString(),this.docname="",this.clinic="",this.clinics="",this.firstClinic="",this.birthdayChild=[],this.API_VACCINE=""+o.a.BASE_URL}ngOnInit(){this.storage.get(o.a.DOCTOR_Id).then(l=>{this.doctorId=l,this.doctorId&&(console.log("Load Doctor"),this.loadDoctorDetails(this.doctorId))}),this.getBirthdayChild(this.selectedDate)}getBirthdayChild(l){return i.a(this,void 0,void 0,(function*(){this.formattedDate=l;const n=yield this.loadingController.create({message:"Loading...",spinner:"circles"});yield n.present(),this.birthdayService.getBirthdayAlert(this.formattedDate,this.doctorId).subscribe(l=>i.a(this,void 0,void 0,(function*(){l?(this.birthdayChild=l.ResponseData||[],console.log("Birthday Child List:",this.birthdayChild),yield n.dismiss()):this.toastService.create(l.Message||"An error occurred.","danger")})),l=>i.a(this,void 0,void 0,(function*(){yield n.dismiss(),this.toastService.create(l.message||"Failed to fetch data.","danger")})))}))}formatDateToString(l){const n=new Date(l);return`${("0"+(n.getMonth()+1)).slice(-2)}-${("0"+n.getDate()).slice(-2)}`}onDateChange(l){this.selectedDate=l.value,this.getBirthdayChild(this.formatDateToString(this.selectedDate))}loadDoctorDetails(l){console.log("Doctor ID:",l),this.birthdayService.loadDoctorDetails(l).subscribe(l=>{if(console.log("Full API Response:",l),l.IsSuccess){const n=l.ResponseData;if(console.log("DoctorDetails Object:",n),this.docname=n.DisplayName,this.clinics=Array.isArray(n.Clinics)?n.Clinics:[],console.log("Clinic List:",this.clinics),this.clinics.length>0)if(Array.isArray(this.clinics)&&this.clinics.length>0){const l=this.clinics[0];"object"==typeof l&&null!==l?this.clinic=l.Name||l.ClinicName||"Unknown Clinic":(console.error("firstClinic is not an object:",l),this.clinic="Unknown Clinic")}else this.clinic="Unknown Clinic";else this.clinic="Unknown Clinic"}else console.error("Error fetching doctor details:",l.Message)},l=>{console.error("API Error:",l)})}sendemails(){return i.a(this,void 0,void 0,(function*(){const l=yield this.loadingController.create({message:"Sending birthday emails"});yield l.present(),yield this.birthdayService.sendEmailToAll(this.doctorId).subscribe(n=>{n.IsSuccess?(l.dismiss(),this.toastService.create("Birthday emails sent successfull","success")):(l.dismiss(),this.toastService.create(n.Message,"danger"))},n=>{l.dismiss(),this.toastService.create(n,"danger")})}))}sendemail(l){return i.a(this,void 0,void 0,(function*(){console.log(l),console.log(l[0].Id);const n=yield this.loadingController.create({message:"sending email"});yield n.present(),yield this.birthdayService.sendBirthdayMails(l[0].Id).subscribe(l=>{l.IsSuccess?(n.dismiss(),this.toastService.create("email sent successfully","success")):(n.dismiss(),this.toastService.create(l.Message,"danger"))},l=>{n.dismiss(),this.toastService.create(l,"danger")})}))}downloadcsv(){let l="";this.birthdayChild.map(l=>l.Id).forEach(n=>{n&&(l+="arr[]="+n+"&")});const n=`${this.API_VACCINE}Birthday/export-birthdays-csv?${l}`;this.platform.is("desktop")||this.platform.is("mobileweb")?window.open(n,"_blank"):this.downloader.download({uri:n,title:"Child Alerts CSV",description:"Downloading follow-up alerts CSV",mimeType:"text/csv",visibleInDownloadsUi:!0,notificationVisibility:b.b.VisibleNotifyCompleted,destinationInExternalFilesDir:{dirType:"Downloads",subPath:"Child Alerts.csv"}}).then(l=>{console.log("File downloaded at:",l),this.toastService.create("File downloaded successfully","success")}).catch(l=>{console.error("Download failed:",l),this.toastService.create("Failed to download file","danger")})}openWhatsApp(l,n,t){if(""===l.trim())return void alert("Invalid mobile number. Please provide a valid number.");const e=encodeURIComponent(`\u{1f389} *Happy Birthday, ${n}!* \u{1f382}\n\nWishing you a day filled with joy, laughter, and happiness! May your year ahead be full of success and good health. \u{1f388}\n\n\u{1f381} *Date of Birth:* ${t}\n\u{1f3e5} *Clinic:* ${this.clinic}\n\nBest wishes,\n\u{1f468}\u200d\u2695\ufe0f `+this.docname),i=l.startsWith("+92")?l:"+92"+l.replace(/^0/,"");let a;a=this.platform.is("android")||this.platform.is("ios")?`whatsapp://send?phone=${i}&text=${e}`:`https://web.whatsapp.com/send?phone=${i}&text=${e}`,window.open(a,"_system")}}class p{}var g=t("pMnS"),m=t("t68o"),D=t("zbXB"),f=t("MKJQ"),y=t("sZkV"),B=t("SVse"),v=t("HsOI"),C=t("ZwOa"),k=t("s7LF"),I=t("821u"),w=t("Xd0L"),x=t("/HVE"),S=t("oapL"),A=t("s6ns"),q=t("QQfA"),_=t("IP0z"),O=t("xgBC"),$=e.pb({encapsulation:2,styles:[],data:{}});function j(l){return e.Nb(0,[(l()(),e.rb(0,0,null,null,2,"div",[["class","no-birthday-alert"]],null,null,null,null,null)),(l()(),e.rb(1,0,null,null,1,"h1",[["style","color: red"]],null,null,null,null,null)),(l()(),e.Lb(-1,null,["No birthday alert for today."]))],null,null)}function E(l){return e.Nb(0,[(l()(),e.rb(0,0,null,null,8,"ion-item",[],null,null,null,f.xb,f.y)),e.qb(1,49152,null,0,y.H,[e.h,e.k,e.x],null,null),(l()(),e.rb(2,0,null,0,2,"ion-label",[],null,null,null,f.yb,f.z)),e.qb(3,49152,null,0,y.N,[e.h,e.k,e.x],null,null),(l()(),e.Lb(4,0,["",""])),(l()(),e.rb(5,0,null,0,1,"ion-icon",[["color","primary"],["name","mail"],["slot","end"],["style","cursor: pointer"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.sendemail([l.context.$implicit])&&e),e}),f.sb,f.t)),e.qb(6,49152,null,0,y.C,[e.h,e.k,e.x],{color:[0,"color"],name:[1,"name"]},null),(l()(),e.rb(7,0,null,0,1,"ion-icon",[["name","logo-whatsapp"],["slot","end"],["style","cursor: pointer"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.openWhatsApp(l.context.$implicit.User.MobileNumber,l.context.$implicit.Name,l.context.$implicit.DOB)&&e),e}),f.sb,f.t)),e.qb(8,49152,null,0,y.C,[e.h,e.k,e.x],{color:[0,"color"],name:[1,"name"]},null)],(function(l,n){l(n,6,0,"primary","mail"),l(n,8,0,n.context.$implicit.isMessageSent?"primary":"success","logo-whatsapp")}),(function(l,n){l(n,4,0,n.context.$implicit.Name)}))}function N(l){return e.Nb(0,[(l()(),e.rb(0,0,null,null,7,"ion-grid",[],null,null,null,f.qb,f.r)),e.qb(1,49152,null,0,y.A,[e.h,e.k,e.x],null,null),(l()(),e.rb(2,0,null,0,5,"ion-row",[],null,null,null,f.Jb,f.K)),e.qb(3,49152,null,0,y.gb,[e.h,e.k,e.x],null,null),(l()(),e.rb(4,0,null,0,3,"ion-col",[],null,null,null,f.lb,f.m)),e.qb(5,49152,null,0,y.t,[e.h,e.k,e.x],null,null),(l()(),e.gb(16777216,null,0,1,null,E)),e.qb(7,278528,null,0,B.l,[e.N,e.K,e.q],{ngForOf:[0,"ngForOf"]},null)],(function(l,n){l(n,7,0,n.component.birthdayChild)}),null)}function L(l){return e.Nb(0,[(l()(),e.rb(0,0,null,null,36,"ion-content",[["class","ion-padding"]],null,null,null,f.mb,f.n)),e.qb(1,49152,null,0,y.u,[e.h,e.k,e.x],null,null),(l()(),e.rb(2,0,null,0,30,"ion-toolbar",[],null,null,null,f.Xb,f.Y)),e.qb(3,49152,null,0,y.zb,[e.h,e.k,e.x],null,null),(l()(),e.rb(4,0,null,0,7,"ion-buttons",[["slot","start"]],null,null,null,f.eb,f.f)),e.qb(5,49152,null,0,y.l,[e.h,e.k,e.x],null,null),(l()(),e.rb(6,0,null,0,2,"ion-button",[["color","primary"],["fill","outline"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.sendemails()&&e),e}),f.db,f.e)),e.qb(7,49152,null,0,y.k,[e.h,e.k,e.x],{color:[0,"color"],disabled:[1,"disabled"],fill:[2,"fill"]},null),(l()(),e.Lb(-1,0,["Email"])),(l()(),e.rb(9,0,null,0,2,"ion-button",[["color","primary"],["fill","outline"]],null,[[null,"click"]],(function(l,n,t){var e=!0;return"click"===n&&(e=!1!==l.component.downloadcsv()&&e),e}),f.db,f.e)),e.qb(10,49152,null,0,y.k,[e.h,e.k,e.x],{color:[0,"color"],disabled:[1,"disabled"],fill:[2,"fill"]},null),(l()(),e.Lb(-1,0,["Sheet"])),(l()(),e.rb(12,0,null,0,20,"ion-buttons",[["slot","end"]],null,null,null,f.eb,f.f)),e.qb(13,49152,null,0,y.l,[e.h,e.k,e.x],null,null),(l()(),e.rb(14,0,null,0,18,"ion-item",[],null,[[null,"click"]],(function(l,n,t){var i=!0;return"click"===n&&(i=!1!==e.Db(l,32).open()&&i),i}),f.xb,f.y)),e.qb(15,49152,null,0,y.H,[e.h,e.k,e.x],null,null),(l()(),e.rb(16,0,null,0,10,"input",[["class","mat-input-element mat-form-field-autofill-control"],["matInput",""]],[[1,"aria-haspopup",0],[1,"aria-owns",0],[1,"min",0],[1,"max",0],[8,"disabled",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[2,"mat-input-server",null],[1,"id",0],[1,"placeholder",0],[8,"disabled",0],[8,"required",0],[1,"readonly",0],[1,"aria-describedby",0],[1,"aria-invalid",0],[1,"aria-required",0]],[[null,"ngModelChange"],[null,"dateChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"],[null,"keydown"],[null,"focus"]],(function(l,n,t){var i=!0,a=l.component;return"input"===n&&(i=!1!==e.Db(l,18)._handleInput(t.target.value)&&i),"blur"===n&&(i=!1!==e.Db(l,18).onTouched()&&i),"compositionstart"===n&&(i=!1!==e.Db(l,18)._compositionStart()&&i),"compositionend"===n&&(i=!1!==e.Db(l,18)._compositionEnd(t.target.value)&&i),"input"===n&&(i=!1!==e.Db(l,19)._onInput(t.target.value)&&i),"change"===n&&(i=!1!==e.Db(l,19)._onChange()&&i),"blur"===n&&(i=!1!==e.Db(l,19)._onBlur()&&i),"keydown"===n&&(i=!1!==e.Db(l,19)._onKeydown(t)&&i),"blur"===n&&(i=!1!==e.Db(l,26)._focusChanged(!1)&&i),"focus"===n&&(i=!1!==e.Db(l,26)._focusChanged(!0)&&i),"input"===n&&(i=!1!==e.Db(l,26)._onInput()&&i),"ngModelChange"===n&&(i=!1!==(a.selectedDate=t)&&i),"dateChange"===n&&(i=!1!==a.onDateChange(t)&&i),i}),null,null)),e.Ib(6144,null,v.c,null,[C.b]),e.qb(18,16384,null,0,k.c,[e.C,e.k,[2,k.a]],null,null),e.qb(19,147456,null,0,I.h,[e.k,[2,w.a],[2,w.d],[2,v.b]],{matDatepicker:[0,"matDatepicker"]},{dateChange:"dateChange"}),e.Ib(1024,null,k.m,(function(l){return[l]}),[I.h]),e.Ib(1024,null,k.n,(function(l,n){return[l,n]}),[k.c,I.h]),e.qb(22,671744,null,0,k.s,[[8,null],[6,k.m],[8,null],[6,k.n]],{model:[0,"model"]},{update:"ngModelChange"}),e.Ib(2048,null,k.o,null,[k.s]),e.qb(24,16384,null,0,k.p,[[4,k.o]],null,null),e.Ib(2048,null,C.a,null,[I.h]),e.qb(26,999424,null,0,C.b,[e.k,x.a,[6,k.o],[2,k.r],[2,k.j],w.b,[6,C.a],S.a,e.x],null,null),(l()(),e.rb(27,0,null,0,3,"mat-datepicker-toggle",[["class","mat-datepicker-toggle"],["matSuffix",""]],[[1,"tabindex",0],[2,"mat-datepicker-toggle-active",null],[2,"mat-accent",null],[2,"mat-warn",null]],[[null,"focus"]],(function(l,n,t){var i=!0;return"focus"===n&&(i=!1!==e.Db(l,28)._button.focus()&&i),i}),D.e,D.d)),e.qb(28,1753088,null,1,I.k,[I.i,e.h,[8,null]],{datepicker:[0,"datepicker"]},null),e.Jb(603979776,1,{_customIcon:0}),e.qb(30,16384,null,0,v.e,[],null,null),(l()(),e.rb(31,16777216,null,0,1,"mat-datepicker",[],null,null,null,D.f,D.c)),e.qb(32,180224,[["picker",4]],0,I.f,[A.d,q.a,e.x,e.N,I.a,[2,w.a],[2,_.b],[2,B.d]],null,null),(l()(),e.gb(16777216,null,0,1,null,j)),e.qb(34,16384,null,0,B.m,[e.N,e.K],{ngIf:[0,"ngIf"]},null),(l()(),e.gb(16777216,null,0,1,null,N)),e.qb(36,16384,null,0,B.m,[e.N,e.K],{ngIf:[0,"ngIf"]},null)],(function(l,n){var t=n.component;l(n,7,0,"primary",0==t.birthdayChild.length,"outline"),l(n,10,0,"primary",0==t.birthdayChild.length,"outline"),l(n,19,0,e.Db(n,32)),l(n,22,0,t.selectedDate),l(n,26,0),l(n,28,0,e.Db(n,32)),l(n,34,0,0===t.birthdayChild.length),l(n,36,0,t.birthdayChild.length>0)}),(function(l,n){l(n,16,1,[e.Db(n,19)._datepicker?"dialog":null,(null==e.Db(n,19)._datepicker?null:e.Db(n,19)._datepicker.opened)&&e.Db(n,19)._datepicker.id||null,e.Db(n,19).min?e.Db(n,19)._dateAdapter.toIso8601(e.Db(n,19).min):null,e.Db(n,19).max?e.Db(n,19)._dateAdapter.toIso8601(e.Db(n,19).max):null,e.Db(n,19).disabled,e.Db(n,24).ngClassUntouched,e.Db(n,24).ngClassTouched,e.Db(n,24).ngClassPristine,e.Db(n,24).ngClassDirty,e.Db(n,24).ngClassValid,e.Db(n,24).ngClassInvalid,e.Db(n,24).ngClassPending,e.Db(n,26)._isServer,e.Db(n,26).id,e.Db(n,26).placeholder,e.Db(n,26).disabled,e.Db(n,26).required,e.Db(n,26).readonly&&!e.Db(n,26)._isNativeSelect||null,e.Db(n,26)._ariaDescribedby||null,e.Db(n,26).errorState,e.Db(n,26).required.toString()]),l(n,27,0,-1,e.Db(n,28).datepicker&&e.Db(n,28).datepicker.opened,e.Db(n,28).datepicker&&"accent"===e.Db(n,28).datepicker.color,e.Db(n,28).datepicker&&"warn"===e.Db(n,28).datepicker.color)}))}function M(l){return e.Nb(0,[(l()(),e.rb(0,0,null,null,1,"app-birthday-alert",[],null,null,null,L,$)),e.qb(1,114688,null,0,h,[y.Db,d,a.a,O.b,y.Hb,b.a],null,null)],(function(l,n){l(n,1,0)}),null)}var P=e.nb("app-birthday-alert",h,M,{},{},[]),R=t("POq0"),T=t("iInd"),U=t("cUpR"),F=t("Fwaw"),V=t("zMNK"),J=t("hOhj"),H=t("5GAg");t.d(n,"BirthdayAlertPageModuleNgFactory",(function(){return K}));var K=e.ob(p,[],(function(l){return e.Ab([e.Bb(512,e.j,e.Z,[[8,[g.a,m.a,D.b,D.a,P]],[3,e.j],e.v]),e.Bb(4608,B.o,B.n,[e.s,[2,B.D]]),e.Bb(4608,k.y,k.y,[]),e.Bb(4608,y.b,y.b,[e.x,e.g]),e.Bb(4608,y.Eb,y.Eb,[y.b,e.j,e.p]),e.Bb(4608,y.Ib,y.Ib,[y.b,e.j,e.p]),e.Bb(4608,q.a,q.a,[q.g,q.c,e.j,q.f,q.d,e.p,e.x,B.d,_.b,[2,B.i]]),e.Bb(5120,q.h,q.i,[q.a]),e.Bb(5120,A.b,A.c,[q.a]),e.Bb(135680,A.d,A.d,[q.a,e.p,[2,B.i],[2,A.a],A.b,[3,A.d],q.c]),e.Bb(4608,R.c,R.c,[]),e.Bb(4608,I.i,I.i,[]),e.Bb(5120,I.a,I.b,[q.a]),e.Bb(4608,w.b,w.b,[]),e.Bb(4608,w.a,w.u,[[2,w.e],x.a]),e.Bb(4608,k.f,k.f,[]),e.Bb(4608,b.a,b.a,[]),e.Bb(1073742336,B.b,B.b,[]),e.Bb(1073742336,k.x,k.x,[]),e.Bb(1073742336,k.l,k.l,[]),e.Bb(1073742336,y.Bb,y.Bb,[]),e.Bb(1073742336,T.q,T.q,[[2,T.v],[2,T.n]]),e.Bb(1073742336,_.a,_.a,[]),e.Bb(1073742336,w.j,w.j,[[2,w.c],[2,U.f]]),e.Bb(1073742336,x.b,x.b,[]),e.Bb(1073742336,w.t,w.t,[]),e.Bb(1073742336,F.c,F.c,[]),e.Bb(1073742336,V.f,V.f,[]),e.Bb(1073742336,J.b,J.b,[]),e.Bb(1073742336,q.e,q.e,[]),e.Bb(1073742336,A.g,A.g,[]),e.Bb(1073742336,R.d,R.d,[]),e.Bb(1073742336,H.a,H.a,[]),e.Bb(1073742336,I.j,I.j,[]),e.Bb(1073742336,S.c,S.c,[]),e.Bb(1073742336,v.d,v.d,[]),e.Bb(1073742336,C.c,C.c,[]),e.Bb(1073742336,w.v,w.v,[]),e.Bb(1073742336,w.l,w.l,[]),e.Bb(1073742336,k.u,k.u,[]),e.Bb(1073742336,p,p,[]),e.Bb(256,w.d,w.g,[]),e.Bb(1024,T.l,(function(){return[[{path:"",component:h}]]}),[])])}))}}]);